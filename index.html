<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <title>Password Protected</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex, nofollow">
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/main.css">
  <link rel="icon" type="image/png" href="./favicon.png" />
</head>

<body>
  <form class="protected">
    <div class="protected__alert" data-id="alert">You entered an incorrect password</div>
    <div class="protected__content">
      <h1 class="protected__content__heading">Please enter the password provided on your wedding invitation</h1>
      <input class="protected__content__input" data-id="password" type="password" placeholder="Enter password" />
      <button data-id="button" type="button" class="button">Continue</button>
    </div>
  </form>

  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/js-sha1/0.6.0/sha1.min.js"></script>
  <script type="text/javascript">

    "use strict"
    const button = document.querySelectorAll('[data-id="button"]')
    const password = document.querySelectorAll('[data-id="password"]')

    function login(secret) {
      console.log('scret', secret)
      console.log(sha1)
      const hash = sha1(secret);
      const url = `${hash}/index.html`;
      const alert = document.querySelectorAll('[data-id="alert"]');

      const request = new XMLHttpRequest();
      console.log(url)
      request.open('GET', url, true);

      request.onload = function () {
        console.log(request)
        if (request.status >= 200 && request.status < 400) {
          window.location = url;
        } else {
          parent.location.hash = hash;
          alert[0].style.display = 'block';
          password[0].setAttribute('placeholder', 'Incorrect password');
          password[0].value = '';
        }
      }
      request.onerror = function () {
        parent.location.hash = hash;
        alert[0].style.display = 'block';
        password[0].setAttribute('placeholder', 'Incorrect password');
        password[0].value = '';
      }
      request.send();
    }

    button[0].addEventListener("click", function () {
      login(password[0].value);
    })

    document.onkeydown = function (e) {
      e = e || window.event;
      if (e.key === 'Enter') {
        login(password[0].value);
      }
    }
  </script>
</body>

</html>